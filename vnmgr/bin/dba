#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)

require 'rubygems'
require 'dcell'
require 'vnmgr'

path = ['/etc/wakame-vnet/dba.conf',File.expand_path('../deployment/conf_files/etc/wakame-vnet/dba.conf', Vnmgr::VNMGR_ROOT)].find { |i| File.exists?(i) }

conf = Vnmgr::Configurations::Dba.load(path).config

DCell.start :id => conf[:cluster_name], :addr => "tcp://#{conf[:db_agent_ip]}:#{conf[:db_agent_port]}",
  :registry => {
    :adapter => 'redis',
    :host => conf[:redis_host],
    :port => conf[:redis_port]
  }

Vnmgr::NodeModules::DbAgent.supervise_as conf[:node_name]
sleep
