#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)

require 'rubygems'
require 'dcell'
require 'vnmgr'

dba = Vnmgr::Configurations::Dba.load('/etc/wakame-vnet/dba.conf')
common = Vnmgr::Configurations::Common.load('/etc/wakame-vnet/common.conf')
Vnmgr::Initializers::DB.run(dba.db_uri)

DCell.start :id => dba.cluster_name, :addr => "tcp://#{dba.ip}:#{dba.port}",
  :registry => {
    :adapter => 'redis',
    :host => common.redis_host,
    :port => common.redis_port
  }

Vnmgr::NodeModules::Dba.supervise_as dba.node_name, dba.db_tables
sleep
