#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)

require 'rubygems'
require 'bundler/setup'
require 'dcell'
require 'vnmgr'

config_dir="/etc/wakame-vnet/"
conf = Vnmgr::Configurations::Dba.load(File.join(config_dir, 'common.conf'), File.join(config_dir, 'dba.conf'))

Vnmgr::Initializers::DB.run(conf.db_uri)

DCell.start :id => conf.node_name, :addr => "tcp://#{conf.ip}:#{conf.port}",
  :registry => {
    :adapter => 'redis',
    :host => conf.redis_host,
    :port => conf.redis_port
  }

conf.actor_names.each do |actor_name|
  Vnmgr::NodeModules.const_get(actor_name.camelize).supervise_as actor_name
end

sleep
