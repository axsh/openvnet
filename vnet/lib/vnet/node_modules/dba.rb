# -*- coding: utf-8 -*-

require 'sequel'

module Vnet::NodeModules
  class Dba
    include Celluloid
    include Celluloid::Logger

    task_class TaskThread

    def initialize(*args, &block)
      info "Dba initalized."
      @model_classes = {}
    end

    def execute(class_name, method_name, *args)
      class_name = class_name.to_sym
      begin
        unless @model_classes[class_name]
          @model_classes[class_name] = Vnet::DataAccess::Models.const_get(class_name.to_s.camelize).new
        end
        @model_classes[class_name].send(method_name, *args)
      rescue => e
        error(e)
        abort(e)
      end
    end
  end
end
